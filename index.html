<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Painting Business Scheduler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f4f4f7;
      color: #111827;
      padding: 16px;
    }

    h1, h2, h3 {
      font-weight: 600;
    }

    .app-shell {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .header-title {
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5e7eb;
      color: #374151;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (min-width: 900px) {
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
    }

    .column {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }

    .column.left {
      flex: 0 0 360px;
    }

    .column.right {
      flex: 1;
      min-width: 0;
    }

    .column h2 {
      margin-bottom: 12px;
      font-size: 1.1rem;
    }

    .section {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .section:last-child {
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 0;
    }

    .section-title {
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: #4b5563;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-size: 0.8rem;
      color: #4b5563;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    input, select, textarea {
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 6px 10px;
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.4);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 4px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #ffffff;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .pill {
      font-size: 0.8rem;
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      cursor: pointer;
    }

    .pill.active {
      background: #111827;
      color: #f9fafb;
      border-color: #111827;
    }

    .jobs-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    .job-card {
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      background: #f9fafb;
    }

    .job-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 4px;
    }

    .job-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .job-meta {
      font-size: 0.78rem;
      color: #4b5563;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .job-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .status-select {
      font-size: 0.78rem;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .small {
      font-size: 0.75rem;
      color: #6b7280;
    }

    .empty-state {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 4px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e5e7eb;
      color: #374151;
    }

    .chip-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #10b981;
    }

    .status-scheduled   { background: #dbeafe; color: #1d4ed8; }
    .status-inprogress  { background: #fef3c7; color: #b45309; }
    .status-completed   { background: #dcfce7; color: #166534; }
    .status-cancelled   { background: #fee2e2; color: #b91c1c; }

    .status-scheduled .chip-dot   { background: #2563eb; }
    .status-inprogress .chip-dot  { background: #f59e0b; }
    .status-completed .chip-dot   { background: #22c55e; }
    .status-cancelled .chip-dot   { background: #ef4444; }

    .notes {
      font-size: 0.78rem;
      margin-top: 4px;
      color: #4b5563;
      white-space: pre-wrap;
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .toolbar input {
      max-width: 220px;
    }

    .tagline {
      font-size: 0.8rem;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="header">
      <div>
        <div class="header-title">
          üé® Painting Schedule
          <span class="badge">Local Only ¬∑ Offline</span>
        </div>
        <div class="tagline">Track customers & jobs for your painting business.</div>
      </div>
      <div class="small" id="todayLabel"></div>
    </header>

    <main class="layout">
      <!-- LEFT COLUMN ‚Äì FORMS -->
      <section class="column left">
        <h2>Add & Manage</h2>

        <div class="section">
          <div class="section-title">New Customer</div>
          <form id="customerForm">
            <label>
              Name
              <input type="text" id="customerName" required />
            </label>
            <label>
              Phone
              <input type="tel" id="customerPhone" placeholder="555-123-4567" />
            </label>
            <label>
              Email
              <input type="email" id="customerEmail" />
            </label>
            <label>
              Address
              <input type="text" id="customerAddress" placeholder="Street, City" />
            </label>
            <button type="submit" class="btn btn-primary">Ôºã Save Customer</button>
          </form>
        </div>

        <div class="section">
          <div class="section-title">New Job</div>
          <form id="jobForm">
            <label>
              Customer
              <select id="jobCustomer" required>
                <option value="">Select a customer‚Ä¶</option>
              </select>
            </label>
            <label>
              Date
              <input type="date" id="jobDate" required />
            </label>
            <label>
              Start time
              <input type="time" id="jobTime" required />
            </label>
            <label>
              Duration (hours)
              <input type="number" id="jobDuration" min="1" step="0.5" value="4" />
            </label>
            <label>
              Price ($)
              <input type="number" id="jobPrice" min="0" step="1" />
            </label>
            <label>
              Status
              <select id="jobStatus">
                <option value="Scheduled">Scheduled</option>
                <option value="In Progress">In Progress</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
            </label>
            <label>
              Notes
              <textarea id="jobNotes" placeholder="Room count, colors, interior/exterior, access notes‚Ä¶"></textarea>
            </label>
            <button type="submit" class="btn btn-primary">Ôºã Add Job</button>
          </form>
        </div>

        <div class="section">
          <div class="section-title">Quick Stats</div>
          <div class="small" id="stats"></div>
        </div>
      </section>

      <!-- RIGHT COLUMN ‚Äì JOB VIEWS -->
      <section class="column right">
        <div class="toolbar">
          <h2>Schedule</h2>
          <input type="search" id="searchInput" placeholder="Search by customer or address‚Ä¶" />
        </div>

        <div class="pill-row" id="viewPills">
          <button class="pill active" data-view="today">Today</button>
          <button class="pill" data-view="week">Next 7 Days</button>
          <button class="pill" data-view="all">All Jobs</button>
        </div>

        <div id="jobsContainer" class="jobs-list"></div>
      </section>
    </main>
  </div>

  <script>
    // ---- Data & Storage ----
    const STORAGE_KEYS = {
      CUSTOMERS: 'painting_customers',
      JOBS: 'painting_jobs'
    };

    let customers = [];
    let jobs = [];
    let currentView = 'today';
    let currentSearch = '';

    function loadData() {
      try {
        customers = JSON.parse(localStorage.getItem(STORAGE_KEYS.CUSTOMERS)) || [];
        jobs = JSON.parse(localStorage.getItem(STORAGE_KEYS.JOBS)) || [];
      } catch (e) {
        customers = [];
        jobs = [];
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEYS.CUSTOMERS, JSON.stringify(customers));
      localStorage.setItem(STORAGE_KEYS.JOBS, JSON.stringify(jobs));
    }

    // ---- Helpers ----
    function formatCurrency(value) {
      const n = Number(value || 0);
      if (Number.isNaN(n)) return '$0';
      return '$' + n.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function getTodayISO() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    }

    function isToday(dateStr) {
      return dateStr === getTodayISO();
    }

    function isWithinNext7Days(dateStr) {
      const today = new Date(getTodayISO());
      const d = new Date(dateStr);
      const diffMs = d - today;
      const diffDays = diffMs / (1000 * 60 * 60 * 24);
      return diffDays >= 0 && diffDays < 7;
    }

    function getCustomerById(id) {
      return customers.find(c => c.id === id);
    }

    function generateId(prefix) {
      return prefix + '_' + Math.random().toString(36).slice(2, 10);
    }

    function statusClass(status) {
      switch ((status || '').toLowerCase()) {
        case 'scheduled': return 'status-scheduled';
        case 'in progress': return 'status-inprogress';
        case 'completed': return 'status-completed';
        case 'cancelled': return 'status-cancelled';
        default: return '';
      }
    }

    // ---- Renderers ----
    function renderTodayLabel() {
      const el = document.getElementById('todayLabel');
      const d = new Date();
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      el.textContent = d.toLocaleDateString(undefined, options);
    }

    function renderCustomerOptions() {
      const select = document.getElementById('jobCustomer');
      const currentValue = select.value;
      select.innerHTML = '<option value="">Select a customer‚Ä¶</option>';
      customers
        .slice()
        .sort((a, b) => a.name.localeCompare(b.name))
        .forEach(c => {
          const opt = document.createElement('option');
          opt.value = c.id;
          opt.textContent = c.name;
          select.appendChild(opt);
        });
      if (currentValue) {
        select.value = currentValue;
      }
    }

    function renderStats() {
      const statsEl = document.getElementById('stats');
      const totalJobs = jobs.length;
      const openJobs = jobs.filter(j => j.status !== 'Completed' && j.status !== 'Cancelled').length;
      const todayJobs = jobs.filter(j => isToday(j.date)).length;
      const totalRevenue = jobs
        .filter(j => j.status === 'Completed')
        .reduce((sum, j) => sum + (Number(j.price) || 0), 0);

      statsEl.innerHTML = `
        Total customers: <strong>${customers.length}</strong><br/>
        Total jobs: <strong>${totalJobs}</strong> ¬∑ Open: <strong>${openJobs}</strong><br/>
        Jobs today: <strong>${todayJobs}</strong><br/>
        Completed revenue: <strong>${formatCurrency(totalRevenue)}</strong>
      `;
    }

    function filteredJobs() {
      let list = jobs.slice();

      // View filter
      if (currentView === 'today') {
        list = list.filter(j => isToday(j.date));
      } else if (currentView === 'week') {
        list = list.filter(j => isWithinNext7Days(j.date));
      }

      // Search filter
      if (currentSearch.trim()) {
        const q = currentSearch.toLowerCase();
        list = list.filter(j => {
          const customer = getCustomerById(j.customerId);
          const customerName = customer ? customer.name.toLowerCase() : '';
          const address = customer ? (customer.address || '').toLowerCase() : '';
          const notes = (j.notes || '').toLowerCase();
          return (
            customerName.includes(q) ||
            address.includes(q) ||
            notes.includes(q)
          );
        });
      }

      // Sort by date then time
      list.sort((a, b) => {
        if (a.date === b.date) {
          return (a.time || '').localeCompare(b.time || '');
        }
        return a.date.localeCompare(b.date);
      });

      return list;
    }

    function renderJobs() {
      const container = document.getElementById('jobsContainer');
      container.innerHTML = '';

      const list = filteredJobs();

      if (list.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'empty-state';
        empty.textContent = 'No jobs in this view yet.';
        container.appendChild(empty);
        return;
      }

      list.forEach(job => {
        const customer = getCustomerById(job.customerId);
        const card = document.createElement('div');
        card.className = 'job-card';

        const header = document.createElement('div');
        header.className = 'job-header';

        const title = document.createElement('div');
        title.className = 'job-title';
        title.textContent = customer ? customer.name : 'Unknown customer';

        const statusChip = document.createElement('div');
        const statusCls = statusClass(job.status);
        statusChip.className = `chip ${statusCls}`;
        statusChip.innerHTML = `
          <span class="chip-dot"></span>
          <span>${job.status || 'Scheduled'}</span>
        `;

        header.appendChild(title);
        header.appendChild(statusChip);

        const meta = document.createElement('div');
        meta.className = 'job-meta';
        const dateLabel = new Date(job.date + 'T00:00:00');
        const dateFormatted = dateLabel.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });

        meta.innerHTML = `
          <span>üìÖ ${dateFormatted}</span>
          <span>‚è∞ ${job.time || '--:--'} ¬∑ ${job.duration || 0}h</span>
          <span>üí≤ ${formatCurrency(job.price)}</span>
          ${customer && customer.address ? `<span>üìç ${customer.address}</span>` : ''}
        `;

        const notes = document.createElement('div');
        notes.className = 'notes';
        if (job.notes) {
          notes.textContent = job.notes;
        }

        const footer = document.createElement('div');
        footer.className = 'job-footer';

        const statusLabel = document.createElement('label');
        statusLabel.className = 'small';
        statusLabel.innerHTML = `
          Status<br/>
          <select class="status-select" data-job-id="${job.id}">
            <option value="Scheduled">Scheduled</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        `;

        const select = statusLabel.querySelector('select');
        select.value = job.status || 'Scheduled';

        const smallInfo = document.createElement('div');
        smallInfo.className = 'small';
        smallInfo.textContent = `Job ID: ${job.id.slice(0, 8)}‚Ä¶`;

        footer.appendChild(statusLabel);
        footer.appendChild(smallInfo);

        card.appendChild(header);
        card.appendChild(meta);
        if (job.notes) card.appendChild(notes);
        card.appendChild(footer);

        container.appendChild(card);
      });

      // Attach change listeners for status selects
      container.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', (e) => {
          const jobId = e.target.getAttribute('data-job-id');
          const job = jobs.find(j => j.id === jobId);
          if (job) {
            job.status = e.target.value;
            saveData();
            renderStats();
            renderJobs(); // re-render to refresh chip styling
          }
        });
      });
    }

    function renderViewPills() {
      const pills = document.querySelectorAll('#viewPills .pill');
      pills.forEach(pill => {
        pill.classList.toggle('active', pill.dataset.view === currentView);
      });
    }

    // ---- Event Handlers ----
    function setupForms() {
      const customerForm = document.getElementById('customerForm');
      customerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('customerName').value.trim();
        if (!name) return;

        const customer = {
          id: generateId('c'),
          name,
          phone: document.getElementById('customerPhone').value.trim(),
          email: document.getElementById('customerEmail').value.trim(),
          address: document.getElementById('customerAddress').value.trim()
        };

        customers.push(customer);
        saveData();
        renderCustomerOptions();
        renderStats();

        customerForm.reset();
      });

      const jobForm = document.getElementById('jobForm');
      jobForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const customerId = document.getElementById('jobCustomer').value;
        const date = document.getElementById('jobDate').value;
        const time = document.getElementById('jobTime').value;
        if (!customerId || !date || !time) return;

        const job = {
          id: generateId('j'),
          customerId,
          date,
          time,
          duration: Number(document.getElementById('jobDuration').value) || 0,
          price: Number(document.getElementById('jobPrice').value) || 0,
          status: document.getElementById('jobStatus').value || 'Scheduled',
          notes: document.getElementById('jobNotes').value.trim()
        };

        jobs.push(job);
        saveData();
        renderStats();
        renderJobs();

        jobForm.reset();
        // Keep default duration & status after reset
        document.getElementById('jobDuration').value = 4;
        document.getElementById('jobStatus').value = 'Scheduled';
      });
    }

    function setupViewSwitching() {
      const pills = document.querySelectorAll('#viewPills .pill');
      pills.forEach(pill => {
        pill.addEventListener('click', () => {
          currentView = pill.dataset.view;
          renderViewPills();
          renderJobs();
        });
      });
    }

    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', (e) => {
        currentSearch = e.target.value;
        renderJobs();
      });
    }

    // ---- Init ----
    (function init() {
      loadData();
      renderTodayLabel();
      renderCustomerOptions();
      renderStats();
      setupForms();
      setupViewSwitching();
      setupSearch();

      // Pre-fill job date with today
      document.getElementById('jobDate').value = getTodayISO();

      renderViewPills();
      renderJobs();
    })();
  </script>
</body>
</html>
